/**
 * Minified by jsDelivr using Terser v5.19.0.
 * Original file: /gh/culturecloud/plex-ddl@master/script.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var popupDiv=document.getElementById("div_popup"),popupDiv2=document.getElementById("div_popup2"),bodyDiv=document.getElementById("div_bodycontent"),reselectButton=document.getElementById("reselectbutton"),logoutButton=document.getElementById("logoutbutton"),searchButton=document.getElementById("searchbutton"),searchBar=document.getElementById("searchbar"),messageBox=document.getElementById("messagebox"),message=document.getElementById("message");function showMessage(e){message.innerText=e,messageBox.style.display="flex"}function hideMessage(){message.innerText="",messageBox.style.display="none"}function closePopupdiv2(){hideMessage(),popupDiv2.style.display="none",popupDiv2.innerHTML=""}function closePopupdiv(){hideMessage(),popupDiv.style.display="none",popupDiv.innerHTML=""}function login(){var e=document.getElementById("username_field").value,t=document.getElementById("password_field").value;fetch("https://plex.tv/users/sign_in.json?user[password]="+encodeURIComponent(t)+"&user[login]="+encodeURIComponent(e),{method:"POST",headers:{"X-Plex-Version":"4.99.2","X-Plex-Product":"Plex Web","X-Plex-Client-Identifier":"fsafhjsdlkfhsfdhkshf7"}}).then((e=>e.json())).then((t=>{showMessage("try to login as '"+e+"'");var o=t.user.authToken;fetch("https://plex.tv/api/v2/resources",{method:"GET",headers:{"X-Plex-Version":"4.99.2","X-Plex-Product":"Plex Web","X-Plex-Client-Identifier":"fsafhjsdlkfhsfdhkshf7","X-Plex-Token":o}}).then((e=>e.text())).then((t=>{var o=[],a=(new DOMParser).parseFromString(t,"text/xml").getElementsByTagName("resource");if(a.length<1)return console.error("no media shares connected to your account"),showMessage("successfully logged in but your account has no media shares"),void logout();localStorage.setItem("login",!0);for(let e=0;e<a.length;e++){var n={};if("Plex Media Server"===a[e].getAttribute("product")){n.name=a[e].getAttribute("name"),n.token=a[e].getAttribute("accessToken");var l={},s=a[e].getElementsByTagName("connection");for(let e=0;e<s.length;e++)l[e]=s[e].getAttribute("uri");n.connections=l,o.push(n)}}localStorage.setItem("servers",JSON.stringify(o)),window.location.reload(),showMessage("successfully logged in as "+e+"'")})).catch((e=>{showMessage("cannot get data from account"),console.error("cannot get account data: "+e)}))})).catch((e=>{showMessage("wrong credentials"),console.error("wrong credentials: "+e)}))}function logout(){try{localStorage.clear(),showMessage("logged out successfully"),window.location.reload()}catch{showMessage("something went wrong with logging out"),console.error("something went wrong. please delete all your browser data to log out")}}function selectSelected(e,t){showMessage("trying to connect... please wait!"),fetch(e+"/search?query=&X-Plex-Token="+t,{method:"GET"}).then((e=>e.text())).then((o=>{showMessage("connected successfully"),console.log("your selected server is "+e+" and your token is "+t),localStorage.setItem("selected",!0),localStorage.setItem("selected_url",e),localStorage.setItem("selected_token",t),window.location.reload()})).catch((e=>{showMessage("cannot connect"),console.error("cannot connect: "+e)}))}function searcher(){showMessage("started search. please wait!"),bodyDiv.innerHTML="";var e=document.getElementById("searchbar").value;console.log("search for '"+e+"' started"),fetch(localStorage.getItem("selected_url")+"/search?query="+encodeURIComponent(e)+"&X-Plex-Token="+localStorage.getItem("selected_token"),{method:"GET"}).then((e=>e.text())).then((e=>{hideMessage(),console.log("fetched the data"),bodyDiv.innerHTML="";var t={},o=(new DOMParser).parseFromString(e,"text/xml"),a=o.getElementsByTagName("Video"),n=o.getElementsByTagName("Directory"),l=[a,n];if(a.length<1&&n.length<1)return showMessage("no search results"),void console.error("no media shares connected to your account or no search results found");for(let e=0;e<l.length;e++){var s=l[e];for(let e=0;e<s.length;e++){var d=s[e].getAttribute("type");if("movie"==d||"show"==d){var i=s[e].getAttribute("guid");if(i in t){for(const o of["title","type","year","summary","duration","audienceRating","thumb","art"])null!=t[i][o]&&null!=t[i][o]||(t[i][o]=s[e].getAttribute(o))}else{t[i]={},t[i].title=s[e].getAttribute("title"),t[i].type=s[e].getAttribute("type"),t[i].year=s[e].getAttribute("year"),t[i].summary=s[e].getAttribute("summary"),t[i].duration=Math.round(parseInt(s[e].getAttribute("duration"))/1e3/60),t[i].audienceRating=s[e].getAttribute("audienceRating"),t[i].thumb=s[e].getAttribute("thumb"),t[i].art=s[e].getAttribute("art");var r=s[e].getElementsByTagName("Genre");t[i].genres=[];for(let e=0;e<r.length;e++)t[i].genres.push(r[e].getAttribute("tag"));t[i].files=[]}var c={};c.library=s[e].getAttribute("librarySectionTitle"),c.key=s[e].getAttribute("key"),t[i].files.push(c)}}}console.log("processing the data");for(let e=0;e<Object.keys(t).length;e++){momObj=Object.values(t)[e];var m=document.createElement("div");m.className="div_mediaCard";var u=document.createElement("div");u.className="div_mediaCard_upper";var p=document.createElement("div");p.className="div_mediaCard_Image";var g=document.createElement("img");g.className="img_mediaCard_Image",g.alt="cover",g.src=localStorage.getItem("selected_url")+momObj.thumb+"?X-Plex-Token="+localStorage.getItem("selected_token"),p.appendChild(g),u.append(p);var h=document.createElement("div");h.className="div_mediaCard_Info";var v=document.createElement("div");v.className="div_mediaCard_Title";var f=document.createElement("p");f.className="p_mediaCard_Title",f.title=momObj.title,f.appendChild(document.createTextNode(momObj.title)),v.appendChild(f),h.appendChild(v);var _=document.createElement("div");_.className="div_mediaCard_Info_General";var y=document.createElement("p");y.className="p_mediaCard_Info_General",y.appendChild(document.createTextNode(momObj.year+" • "+momObj.genres+" • "+Math.floor(momObj.duration/60)+"h "+momObj.duration%60+"min")),_.appendChild(y),h.appendChild(_);var b=document.createElement("div");b.className="div_mediaCard_Info_lower";var w=document.createElement("div");w.className="div_mediaCard_Info_lower_Specific";for(let e=0;e<momObj.files.length;e++){var x=document.createElement("div");x.className="div_mediaCard_Info_lower_Specific_under";var E=document.createElement("a");E.className="a_mediaCard_Info_lower_Specific",E.appendChild(document.createTextNode(momObj.files[e].library)),"movie"==momObj.type?E.setAttribute("onclick","downloadMovie('"+momObj.files[e].key+"');"):"show"==momObj.type&&E.setAttribute("onclick","downloadShow('"+momObj.files[e].key+"');"),x.appendChild(E),w.appendChild(x)}b.appendChild(w),h.appendChild(b);var C=document.createElement("div");C.className="div_mediaCard_Info_lower_rating";var I=document.createElement("div");I.className="div_mediaCard_Info_lower_rating_inner";var T=document.createElement("p");T.className="p_mediaCard_Info_lower_rating",T.appendChild(document.createTextNode(momObj.audienceRating)),momObj.audienceRating>7.9?T.classList.add("good"):momObj.audienceRating>5.9?T.classList.add("okay"):momObj.audienceRating>4.9?T.classList.add("bad"):T.classList.add("worst"),I.appendChild(T),C.appendChild(I),b.appendChild(C),h.appendChild(b);var k=document.createElement("div");k.className="div_mediaCard_lower";var M=document.createElement("div");M.className="div_mediaCard_lower_summary";var S=document.createElement("p");S.className="p_mediaCard_lower_summary";if(momObj.summary.length>150)momObj.summary.substring(0,150);else momObj.summary;S.appendChild(document.createTextNode(momObj.summary)),M.appendChild(S),k.append(M),u.append(h),m.append(u),m.append(k),bodyDiv.appendChild(m)}})).catch((e=>{showMessage("error with parsing the data"),console.error("error with parsing xml: "+e)}))}function reselect(){localStorage.removeItem("selected"),window.location.reload()}function downloadMovie(e){showMessage("getting movie download url"),popupDiv.innerHTML="",fetch(localStorage.getItem("selected_url")+e+"?X-Plex-Token="+localStorage.getItem("selected_token"),{method:"GET"}).then((e=>e.text())).then((e=>{var t=(new DOMParser).parseFromString(e,"text/xml").getElementsByTagName("Part"),o=encodeURI(/[^/]*$/.exec(t[0].getAttribute("file"))[0]),a=/^(.*[\/])/.exec(t[0].getAttribute("key"))[1],n=localStorage.getItem("selected_url")+a+o+"?download=0&X-Plex-Token="+localStorage.getItem("selected_token");popupDiv.innerHTML='<div class="div_download_section">\n                <div class="div_download_section_inner">\n                <a class="closebutton" onclick="closePopupdiv()">x</a>\n                    <input id="input_download_section_inner" class="input_download_section_inner" type="text" value="'+n+'" disabled="disabled">\n                    <a href="'+n+'" class="downloadbutton">download</a>\n                    <a href="http://127.0.0.1:9666/flash/add?urls='+n+'" class="jdownloaderbutton" target="_blank">jdownloader_icon</a>\n                    </div>\n            </div>',popupDiv.style.display="flex",bodyDiv.appendChild(popupDiv);var l=document.getElementById("input_download_section_inner");l.focus(),l.select(),navigator.clipboard.writeText(n),showMessage("the url is now in your clipboard")})).catch((e=>{showMessage("failed to fetch downlaod url"),console.error("didn't get any information from the specific file: "+e)}))}function downloadEpisode(e){showMessage("getting tv show download url"),console.log(e),fetch(localStorage.getItem("selected_url")+e+"?X-Plex-Token="+localStorage.getItem("selected_token"),{method:"GET"}).then((e=>e.text())).then((e=>{hideMessage();var t=(new DOMParser).parseFromString(e,"text/xml").getElementsByTagName("Part"),o=encodeURI(/[^/]*$/.exec(t[0].getAttribute("file"))[0]),a=/^(.*[\/])/.exec(t[0].getAttribute("key"))[1],n=localStorage.getItem("selected_url")+a+o+"?download=0&X-Plex-Token="+localStorage.getItem("selected_token");popupDiv2.innerHTML='<div class="div_download_section">\n            <div class="div_download_section_inner">\n            <a class="closebutton" onclick="closePopupdiv2()">x</a>\n                <input id="input_download_section_inner" class="input_download_section_inner" type="text" value="'+n+'" disabled="disabled">\n                <a href="'+n+'" class="downloadbutton">download</a>\n                <a href="http://127.0.0.1:9666/flash/add?urls='+n+'" class="jdownloaderbutton" target="_blank">jdownloader_icon</a>\n                </div>\n        </div>',popupDiv2.style.display="flex",bodyDiv.appendChild(popupDiv2);var l=document.getElementById("input_download_section_inner");l.focus(),l.select(),navigator.clipboard.writeText(n),showMessage("the downlaod url is now in your clipboard")})).catch((e=>{showMessage("cannot fetch download url"),console.error("didn't get any information from the specific file: "+e)}))}function downloadSeason(e){showMessage("getting episodes"),popupDiv.innerHTML="",fetch(localStorage.getItem("selected_url")+e+"?X-Plex-Token="+localStorage.getItem("selected_token"),{method:"GET"}).then((e=>e.text())).then((e=>{hideMessage();var t=(new DOMParser).parseFromString(e,"text/xml").getElementsByTagName("Video"),o=[];for(let e=0;e<t.length;e++){if(console.log(t[e]),"episode"==t[e].getAttribute("type")){var a={};console.log(t[e]),a.title=t[e].getAttribute("title"),a.key=t[e].getAttribute("key"),o.push(a)}}console.log(o);var n=document.createElement("div");n.className="div_mediaSelector";var l=document.createElement("a");l.className="closebutton",l.innerText="x",l.setAttribute("onclick","closePopupdiv()"),n.appendChild(l);for(let e=0;e<Object.keys(o).length;e++){console.log(o[e].title);var s=document.createElement("div");s.className="div_mediaSelector_specific";var d=document.createElement("a");d.className="a_mediaSelector",d.innerText=o[e].title,d.setAttribute("onclick","downloadEpisode('"+o[e].key+"');"),s.appendChild(d),n.appendChild(s)}popupDiv.appendChild(n),bodyDiv.appendChild(popupDiv)})).catch((e=>{showMessage("failed to fetch episodes"),console.error("didn't get any information from the specific file: "+e)}))}function downloadShow(e){showMessage("getting seasons"),popupDiv.innerHTML="",fetch(localStorage.getItem("selected_url")+e+"?X-Plex-Token="+localStorage.getItem("selected_token"),{method:"GET"}).then((e=>e.text())).then((e=>{hideMessage();var t=(new DOMParser).parseFromString(e,"text/xml").getElementsByTagName("Directory"),o=[];for(let e=0;e<t.length;e++){if("season"==t[e].getAttribute("type")){var a={};a.title=t[e].getAttribute("title"),a.key=t[e].getAttribute("key"),o.push(a)}}var n=document.createElement("div");n.className="div_mediaSelector";var l=document.createElement("a");l.className="closebutton",l.innerText="x",l.setAttribute("onclick","closePopupdiv()"),n.appendChild(l);for(let e=0;e<Object.keys(o).length;e++){var s=document.createElement("div");s.className="div_mediaSelector_specific";var d=document.createElement("a");d.className="a_mediaSelector",d.innerText=o[e].title,d.setAttribute("onclick","downloadSeason('"+o[e].key+"');"),s.appendChild(d),n.appendChild(s)}popupDiv.appendChild(n),popupDiv.style.display="flex",bodyDiv.appendChild(popupDiv)})).catch((e=>{showMessage("failed to fetch seasons"),console.error("didn't get any information from the specific file: "+e)}))}$(document).ready((function(){if(popupDiv.style.display="none",popupDiv2.style.display="none",null===localStorage.getItem("login"))reselectButton.classList.add("disabled"),logoutButton.classList.add("disabled"),searchBar.classList.add("disabled"),searchBar.disabled=!0,searchButton.disabled=!0,popupDiv.innerHTML='<div class="div_login">\n            <form class="loginform" action="#" onsubmit="login();return false">\n                    <input class="logininput" name="uname" type="text" placeholder="Plex Username" id="username_field" required>\n                    <input class="logininput" name="pword" type="password" placeholder="Plex Password" id="password_field" required>\n                    <button class="loginbutton" type=”submit” onclick="login()">Submit</button>\n            </form>\n        </div>',popupDiv.style.display="flex";else if(null===localStorage.getItem("selected")){reselectButton.classList.add("disabled"),searchBar.classList.add("disabled"),searchBar.disabled=!0,searchButton.disabled=!0;var e=document.createElement("p");e.className="p_popup_title",e.innerHTML="Select a Connection",popupDiv.appendChild(e);var t=JSON.parse(localStorage.getItem("servers"));for(let e=0;e<t.length;e++){var o=document.createElement("div");o.className="div_selectserver";var a=document.createElement("p");a.className="p_selectserver_title",a.innerHTML=t[e].name,o.appendChild(a);for(let a=0;a<Object.entries(t[e].connections).length;a++){var n=document.createElement("a");n.className="p_selectserver_url",n.setAttribute("onclick","selectSelected('"+t[e].connections[a]+"','"+t[e].token+"')"),n.innerHTML=t[e].connections[a],o.appendChild(n)}popupDiv.appendChild(o)}popupDiv.style.display="flex"}else console.log("nothing")}));
//# sourceMappingURL=/sm/03778b18acc5c53a5f017c6e02a6e4294030a3ae3f6bdf301fc975b152338a52.map